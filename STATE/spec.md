# 功能規格

> 最後更新：2025-12-10

## 功能列表

### 核心功能

| 功能 | 說明 | 狀態 |
|------|------|------|
| 檔案掃描 | 掃描「下載」和「桌面」資料夾中的檔案 | ✅ Done |
| 時間判斷 | 識別修改時間超過 72 小時的檔案 | ✅ Done |
| 安全刪除 | 將檔案移到垃圾桶（可救回） | ✅ Done |
| 定時執行 | 透過 LaunchAgent 每天 23:00 自動執行 | ✅ Done |

### 使用者功能

| 功能 | 說明 | 狀態 |
|------|------|------|
| 安裝腳本 | 一鍵安裝程式和 LaunchAgent | ✅ Done |
| 移除腳本 | 一鍵移除程式和 LaunchAgent | ✅ Done |

---

## 功能詳細規格

### 檔案掃描

**目標**：掃描指定資料夾中的所有檔案，取得檔案資訊

**使用情境**：
1. 程式啟動時，掃描「下載」資料夾
2. 程式啟動時，掃描「桌面」資料夾

**規格**：
- 使用 `FileManager.contentsOfDirectory` 取得檔案列表
- 取得每個檔案的修改時間 (`contentModificationDate`)
- 跳過隱藏檔案（以 `.` 開頭的檔案）
- 包含資料夾（資料夾也會被清理）

**驗收條件**：
- [x] 可以正確取得「下載」資料夾路徑
- [x] 可以正確取得「桌面」資料夾路徑
- [x] 可以列出資料夾中的所有非隱藏檔案
- [x] 可以取得每個檔案的修改時間

---

### 時間判斷

**目標**：判斷檔案是否超過三天（72 小時）

**使用情境**：
1. 掃描完成後，過濾出需要清理的檔案

**規格**：
- 使用檔案的「修改時間」（而非建立時間）
- 超過 72 小時（三天）的檔案會被標記為需要清理
- 時間計算基於當前系統時間

**驗收條件**：
- [x] 修改時間超過 72 小時的檔案被正確識別
- [x] 修改時間在 72 小時內的檔案被正確保留

---

### 安全刪除

**目標**：將檔案移到垃圾桶，而非直接刪除

**使用情境**：
1. 對於超過三天的檔案，移到垃圾桶

**規格**：
- 使用 `FileManager.trashItem` 移到垃圾桶
- 如果移動失敗，記錄錯誤但繼續處理其他檔案
- 資料夾會整個移到垃圾桶（包含內容）

**驗收條件**：
- [x] 檔案成功移到垃圾桶
- [x] 移動失敗時程式不會崩潰
- [x] 資料夾整個移到垃圾桶

---

### 定時執行

**目標**：每天 23:00 自動執行清理

**使用情境**：
1. 使用者安裝後，程式每天自動執行

**規格**：
- 使用 macOS LaunchAgent 機制
- 每天 23:00 執行
- 如果電腦在該時間睡眠，喚醒後會執行
- 輸出日誌到 `/tmp/desktop-cleaner.log`

**驗收條件**：
- [x] LaunchAgent plist 檔案正確配置
- [x] 程式在 23:00 自動執行
- [x] 執行日誌可在 `/tmp/desktop-cleaner.log` 查看

---

## 業務規則

### 清理規則

| 規則 | 說明 |
|------|------|
| 時間基準 | 使用檔案「修改時間」判斷 |
| 清理門檻 | 超過 72 小時（三天） |
| 刪除方式 | 移到垃圾桶（可救回） |
| 隱藏檔案 | 不處理（跳過） |

### 目標資料夾

| 資料夾 | 路徑 |
|--------|------|
| 下載 | `~/Downloads` |
| 桌面 | `~/Desktop` |

---

## 限制與約束

| 項目 | 限制 | 原因 |
|------|------|------|
| 權限 | 需要 Full Disk Access | macOS 安全性限制 |
| 平台 | 僅支援 macOS | 使用 LaunchAgent 機制 |
| 設定 | 無法自訂執行時間和天數 | 第一版簡化設計 |
